(function(e){function t(t){for(var r,c,a=t[0],s=t[1],u=t[2],f=0,d=[];f<a.length;f++)c=a[f],o[c]&&d.push(o[c][0]),o[c]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);l&&l(t);while(d.length)d.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,a=1;a<n.length;a++){var s=n[a];0!==o[s]&&(r=!1)}r&&(i.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},o={app:0},i=[];function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],s=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=s;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var r=n("64a9"),o=n.n(r);o.a},1:function(e,t){},2:function(e,t){},"2e62":function(e,t,n){"use strict";n.r(t),function(e,t,r){var o=n("6ebd"),i=n.n(o),c=(n("4917"),n("6aa2"),n("7f7f"),n("4aa6")),a=n.n(c),s=n("0a0d"),u=n.n(s),l=(n("6b54"),n("a745")),f=n.n(l),d=n("7618");
/*!
 * @overview  RSVP - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/tildeio/rsvp.js/master/LICENSE
 * @version   3.1.0
 */
(function(){function o(e){return"function"===typeof e||"object"===Object(d["a"])(e)&&null!==e}function c(e){return"function"===typeof e}function s(e){return"object"===Object(d["a"])(e)&&null!==e}var l;l=f.a?f.a:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var p=l,b=u.a||function(){return(new Date).getTime()};function v(){}var h=a.a||function(e){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!==Object(d["a"])(e))throw new TypeError("Argument must be an object");return v.prototype=e,new v};function m(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function w(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}var g={mixin:function(e){return e["on"]=this["on"],e["off"]=this["off"],e["trigger"]=this["trigger"],e._promiseCallbacks=void 0,e},on:function(e,t){if("function"!==typeof t)throw new TypeError("Callback must be a function");var n,r=w(this);n=r[e],n||(n=r[e]=[]),-1===m(n,t)&&n.push(t)},off:function(e,t){var n,r,o=w(this);t?(n=o[e],r=m(n,t),-1!==r&&n.splice(r,1)):o[e]=[]},trigger:function(e,t,n){var r,o,i=w(this);if(r=i[e])for(var c=0;c<r.length;c++)o=r[c],o(t,n)}},y={instrument:!1};function k(e,t){if("onerror"!==e)return 2!==arguments.length?y[e]:void(y[e]=t);y["on"]("error",t)}g["mixin"](y);var _=[];function C(){setTimeout(function(){for(var e,t=0;t<_.length;t++){e=_[t];var n=e.payload;n.guid=n.key+n.id,n.childGuid=n.key+n.childId,n.error&&(n.stack=n.error.stack),y["trigger"](e.name,e.payload)}_.length=0},50)}function j(e,t,n){1===_.push({name:e,payload:{key:t._guidKey,id:t._id,eventName:e,detail:t._result,childId:n&&n._id,label:t._label,timeStamp:b(),error:y["instrument-with-stack"]?new Error(t._label):null}})&&C()}var S=j;function P(){return new TypeError("A promises callback cannot return that same promise.")}function O(){}var E=void 0,I=1,x=2,D=new q;function A(e){try{return e.then}catch(t){return D.error=t,D}}function T(e,t,n,r){try{e.call(t,n,r)}catch(o){return o}}function N(e,t,n){y.async(function(e){var r=!1,o=T(n,t,function(n){r||(r=!0,t!==n?M(e,n):z(e,n))},function(t){r||(r=!0,B(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,B(e,o))},e)}function U(e,t){t._state===I?z(e,t._result):t._state===x?(t._onError=null,B(e,t._result)):H(t,void 0,function(n){t!==n?M(e,n):z(e,n)},function(t){B(e,t)})}function R(e,t){if(t.constructor===e.constructor)U(e,t);else{var n=A(t);n===D?B(e,D.error):void 0===n?z(e,t):c(n)?N(e,t,n):z(e,t)}}function M(e,t){e===t?z(e,t):o(t)?R(e,t):z(e,t)}function L(e){e._onError&&e._onError(e._result),J(e)}function z(e,t){e._state===E&&(e._result=t,e._state=I,0===e._subscribers.length?y.instrument&&S("fulfilled",e):y.async(J,e))}function B(e,t){e._state===E&&(e._state=x,e._result=t,y.async(L,e))}function H(e,t,n,r){var o=e._subscribers,i=o.length;e._onError=null,o[i]=t,o[i+I]=n,o[i+x]=r,0===i&&e._state&&y.async(J,e)}function J(e){var t=e._subscribers,n=e._state;if(y.instrument&&S(n===I?"fulfilled":"rejected",e),0!==t.length){for(var r,o,i=e._result,c=0;c<t.length;c+=3)r=t[c],o=t[c+n],r?G(n,r,o,i):o(i);e._subscribers.length=0}}function q(){this.error=null}var V=new q;function W(e,t){try{return e(t)}catch(n){return V.error=n,V}}function G(e,t,n,r){var o,i,a,s,u=c(n);if(u){if(o=W(n,r),o===V?(s=!0,i=o.error,o=null):a=!0,t===o)return void B(t,P())}else o=r,a=!0;t._state!==E||(u&&a?M(t,o):s?B(t,i):e===I?z(t,o):e===x&&B(t,o))}function Q(e,t){var n=!1;try{t(function(t){n||(n=!0,M(e,t))},function(t){n||(n=!0,B(e,t))})}catch(r){B(e,r)}}function Z(e,t,n){return e===I?{state:"fulfilled",value:n}:{state:"rejected",reason:n}}function K(e,t,n,r){var o=this;o._instanceConstructor=e,o.promise=new e(O,r),o._abortOnReject=n,o._validateInput(t)?(o._input=t,o.length=t.length,o._remaining=t.length,o._init(),0===o.length?z(o.promise,o._result):(o.length=o.length||0,o._enumerate(),0===o._remaining&&z(o.promise,o._result))):B(o.promise,o._validationError())}var Y=K;function $(e,t){return new Y(this,e,!0,t).promise}K.prototype._validateInput=function(e){return p(e)},K.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},K.prototype._init=function(){this._result=new Array(this.length)},K.prototype._enumerate=function(){for(var e=this,t=e.length,n=e.promise,r=e._input,o=0;n._state===E&&o<t;o++)e._eachEntry(r[o],o)},K.prototype._eachEntry=function(e,t){var n=this,r=n._instanceConstructor;s(e)?e.constructor===r&&e._state!==E?(e._onError=null,n._settledAt(e._state,t,e._result)):n._willSettleAt(r.resolve(e),t):(n._remaining--,n._result[t]=n._makeResult(I,t,e))},K.prototype._settledAt=function(e,t,n){var r=this,o=r.promise;o._state===E&&(r._remaining--,r._abortOnReject&&e===x?B(o,n):r._result[t]=r._makeResult(e,t,n)),0===r._remaining&&z(o,r._result)},K.prototype._makeResult=function(e,t,n){return n},K.prototype._willSettleAt=function(e,t){var n=this;H(e,void 0,function(e){n._settledAt(I,t,e)},function(e){n._settledAt(x,t,e)})};var F=$;function X(e,t){var n=this,r=new n(O,t);if(!p(e))return B(r,new TypeError("You must pass an array to race.")),r;var o=e.length;function i(e){M(r,e)}function c(e){B(r,e)}for(var a=0;r._state===E&&a<o;a++)H(n.resolve(e[a]),void 0,i,c);return r}var ee=X;function te(e,t){var n=this;if(e&&"object"===Object(d["a"])(e)&&e.constructor===n)return e;var r=new n(O,t);return M(r,e),r}var ne=te;function re(e,t){var n=this,r=new n(O,t);return B(r,e),r}var oe=re,ie="rsvp_"+b()+"-",ce=0;function ae(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function se(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function ue(e,t){var n=this;n._id=ce++,n._label=t,n._state=void 0,n._result=void 0,n._subscribers=[],y.instrument&&S("created",n),O!==e&&(c(e)||ae(),n instanceof ue||se(),Q(n,e))}var le=ue;function fe(e,t,n){this._superConstructor(e,t,!1,n)}function de(e,t){return new fe(le,e,t).promise}ue.cast=ne,ue.all=F,ue.race=ee,ue.resolve=ne,ue.reject=oe,ue.prototype={constructor:ue,_guidKey:ie,_onError:function(e){var t=this;y.after(function(){t._onError&&y["trigger"]("error",e,t._label)})},then:function(e,t,n){var r=this,o=r._state;if(o===I&&!e||o===x&&!t)return y.instrument&&S("chained",r,r),r;r._onError=null;var i=new r.constructor(O,n),c=r._result;if(y.instrument&&S("chained",r,i),o){var a=arguments[o-1];y.async(function(){G(o,i,a,c)})}else H(r,i,e,t);return i},catch:function(e,t){return this.then(void 0,e,t)},finally:function(e,t){var n=this,r=n.constructor;return n.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})},t)}},fe.prototype=h(Y.prototype),fe.prototype._superConstructor=Y,fe.prototype._makeResult=Z,fe.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var pe=de;function be(e,t){return le.all(e,t)}var ve,he=be,me=0;function we(e,t){De[me]=e,De[me+1]=t,me+=2,2===me&&xe()}var ge=we,ye="undefined"!==typeof window?window:void 0,ke=ye||{},_e=ke.MutationObserver||ke.WebKitMutationObserver,Ce="undefined"===typeof self&&"undefined"!==typeof e&&"[object process]"==={}.toString.call(e),je="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel;function Se(){var t=e.nextTick,n=e.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return f()(n)&&"0"===n[1]&&"10"===n[2]&&(t=i.a),function(){t(Ae)}}function Pe(){return function(){ve(Ae)}}function Oe(){var e=0,t=new _e(Ae),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function Ee(){var e=new MessageChannel;return e.port1.onmessage=Ae,function(){e.port2.postMessage(0)}}function Ie(){return function(){setTimeout(Ae,1)}}var xe,De=new Array(1e3);function Ae(){for(var e=0;e<me;e+=2){var t=De[e],n=De[e+1];t(n),De[e]=void 0,De[e+1]=void 0}me=0}function Te(){try{var e=n(!function(){var e=new Error("Cannot find module 'vertx'");throw e.code="MODULE_NOT_FOUND",e}());return ve=e.runOnLoop||e.runOnContext,Pe()}catch(t){return Ie()}}function Ne(e){var t={};return t["promise"]=new le(function(e,n){t["resolve"]=e,t["reject"]=n},e),t}xe=Ce?Se():_e?Oe():je?Ee():void 0===ye?Te():Ie();var Ue=Ne;function Re(e,t,n){return le.all(e,n).then(function(e){if(!c(t))throw new TypeError("You must pass a function as filter's second argument.");for(var r=e.length,o=new Array(r),i=0;i<r;i++)o[i]=t(e[i]);return le.all(o,n).then(function(t){for(var n=new Array(r),o=0,i=0;i<r;i++)t[i]&&(n[o]=e[i],o++);return n.length=o,n})})}var Me=Re;function Le(e,t,n){this._superConstructor(e,t,!0,n)}var ze=Le;function Be(e,t,n){this._superConstructor(e,t,!1,n)}function He(e,t){return new Be(le,e,t).promise}Le.prototype=h(Y.prototype),Le.prototype._superConstructor=Y,Le.prototype._init=function(){this._result={}},Le.prototype._validateInput=function(e){return e&&"object"===Object(d["a"])(e)},Le.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},Le.prototype._enumerate=function(){var e=this,t=e.promise,n=e._input,r=[];for(var o in n)t._state===E&&Object.prototype.hasOwnProperty.call(n,o)&&r.push({position:o,entry:n[o]});var i,c=r.length;e._remaining=c;for(var a=0;t._state===E&&a<c;a++)i=r[a],e._eachEntry(i.entry,i.position)},Be.prototype=h(ze.prototype),Be.prototype._superConstructor=Y,Be.prototype._makeResult=Z,Be.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var Je=He;function qe(e,t){return new ze(le,e,t).promise}var Ve=qe;function We(e,t,n){return le.all(e,n).then(function(e){if(!c(t))throw new TypeError("You must pass a function as map's second argument.");for(var r=e.length,o=new Array(r),i=0;i<r;i++)o[i]=t(e[i]);return le.all(o,n)})}var Ge=We;function Qe(){this.value=void 0}var Ze=new Qe,Ke=new Qe;function Ye(e){try{return e.then}catch(t){return Ze.value=t,Ze}}function $e(e,t,n){try{e.apply(t,n)}catch(r){return Ze.value=r,Ze}}function Fe(e,t){for(var n,r,o={},i=e.length,c=new Array(i),a=0;a<i;a++)c[a]=e[a];for(r=0;r<t.length;r++)n=t[r],o[n]=c[r+1];return o}function Xe(e){for(var t=e.length,n=new Array(t-1),r=1;r<t;r++)n[r-1]=e[r];return n}function et(e,t){return{then:function(n,r){return e.call(t,n,r)}}}function tt(e,t){var n=function(){for(var n,r=this,o=arguments.length,i=new Array(o+1),c=!1,a=0;a<o;++a){if(n=arguments[a],!c){if(c=ct(n),c===Ke){var s=new le(O);return B(s,Ke.value),s}c&&!0!==c&&(n=et(c,n))}i[a]=n}var u=new le(O);return i[o]=function(e,n){e?B(u,e):void 0===t?M(u,n):!0===t?M(u,Xe(arguments)):p(t)?M(u,Fe(arguments,t)):M(u,n)},c?it(u,i,e,r):ot(u,i,e,r)};return n.__proto__=e,n}var nt,rt=tt;function ot(e,t,n,r){var o=$e(n,r,t);return o===Ze&&B(e,o.value),e}function it(e,t,n,r){return le.all(t).then(function(t){var o=$e(n,r,t);return o===Ze&&B(e,o.value),e})}function ct(e){return!(!e||"object"!==Object(d["a"])(e))&&(e.constructor===le||Ye(e))}if("object"===("undefined"===typeof self?"undefined":Object(d["a"])(self)))nt=self;else{if("object"!==("undefined"===typeof t?"undefined":Object(d["a"])(t)))throw new Error("no global: `self` or `global` found");nt=t}var at=nt;function st(e,t){return le.race(e,t)}var ut=st;function lt(e,t){return le.reject(e,t)}var ft=lt;function dt(e,t){return le.resolve(e,t)}var pt=dt;function bt(e){throw setTimeout(function(){throw e}),e}var vt=bt;y.async=ge,y.after=function(e){setTimeout(e,0)};function ht(e,t){y.async(e,t)}function mt(){y["on"].apply(y,arguments)}function wt(){y["off"].apply(y,arguments)}if("undefined"!==typeof window&&"object"===Object(d["a"])(window["__PROMISE_INSTRUMENTATION__"])){var gt=window["__PROMISE_INSTRUMENTATION__"];for(var yt in k("instrument",!0),gt)gt.hasOwnProperty(yt)&&mt(yt,gt[yt])}var kt={race:ut,Promise:le,allSettled:pe,hash:Ve,hashSettled:Je,denodeify:rt,on:mt,off:wt,map:Ge,filter:Me,resolve:pt,reject:ft,all:he,rethrow:vt,defer:Ue,EventTarget:g,configure:k,async:ht};"function"===typeof define&&n("3c35")?define(function(){return kt}):r["exports"]?r["exports"]=kt:"undefined"!==typeof at&&(at["RSVP"]=kt)}).call(void 0)}.call(this,n("4362"),n("c8ba"),n("dd40")(e))},3:function(e,t){},4:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"row m-0 mt-3 justify-content-center"},[n("div",{staticClass:"col-4"},[n("label",[e._v("\n                Printer name\n                "),n("select",{directives:[{name:"model",rawName:"v-model",value:e.printerName,expression:"printerName"}],staticClass:"custom-select",attrs:{id:"inputGroupSelect01"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){var t="_value"in e?e._value:e.value;return t});e.printerName=t.target.multiple?n:n[0]}}},e._l(e.printers,function(t){return n("option",{key:t,domProps:{value:t}},[e._v("\n                        "+e._s(t)+"\n                    ")])}),0)]),n("br"),n("label",[e._v("\n                Product code\n                "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.productCode,expression:"productCode"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.productCode},on:{input:function(t){t.target.composing||(e.productCode=t.target.value)}}})]),n("br"),n("label",[e._v("\n                Barcode\n                "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.barcode,expression:"barcode"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.barcode},on:{input:function(t){t.target.composing||(e.barcode=t.target.value)}}})]),n("br"),n("button",{staticClass:"btn btn-primary",on:{click:e.print}},[e._v("Print")])]),e._m(0)])])},i=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"col-6"},[n("canvas",{attrs:{id:"canvas"}})])}];n("7514"),n("28a5");n("2e62"),n("aa3c");var c=n("62c5"),a=n("6c27");qz.api.setSha256Type(function(e){return a(e)});var s=function(){return qz.websocket.connect().then(function(){alert("Connected!")}).catch(function(e){alert(e)})},u=function(e,t,n){var r=l(t,n),o=r.split(",")[1],i=[{type:"image",format:"base64",data:o}];try{var c=qz.configs.create(e,{units:"mm",density:["600","406","300","203"],size:{width:40,height:28},margins:{top:2.5,right:2.5,bottom:2.5,left:2.5},colorType:"blackwhite",interpolation:"nearest-neighbor"});return qz.print(c,i)}catch(a){alert(a)}};function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=document.createElement("canvas"),r=n.getContext("2d");return c(n,t,{format:"CODE39",marginBottom:30}),r.font="14px Arial",r.textAlign="center",r.fillText(e,-n.width/2+10,n.height-10,n.width),n.toDataURL("image/png",1)}var f=function(e,t,n){if(e&&t&&n){c("#"+e,n,{format:"CODE39",marginBottom:30});var r=document.getElementById(e);if(r){var o=r.getContext("2d");o.font="14px Arial",o.textAlign="center",o.fillText(t,-r.width/2+10,r.height-10,r.width)}}},d=function(){return qz.printers.find().then(function(e){return e&&0!==e.length||alert("No available printers"),console.log("AVAILABLE PRINTERS: ",e),e}).catch(function(e){console.log(e)})},p={name:"app",data:function(){return{printers:[],printerName:"",productCode:"UVP10155 - ICE BLACK C",barcode:"0811171"}},methods:{print:function(){u(this.printerName,this.productCode,this.barcode)},renderDemo:function(){f("canvas",this.productCode,this.barcode)}},mounted:function(){var e=this;s().then(function(){return d()}).then(function(t){e.printers=t||[]}),this.renderDemo()},watch:{productCode:"renderDemo",barcode:"renderDemo"}},b=p,v=(n("034f"),n("2877")),h=Object(v["a"])(b,o,i,!1,null,null,null),m=h.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(m)}}).$mount("#app")},"64a9":function(e,t,n){},aa3c:function(e,t,n){"use strict";n.r(t),function(e){n("28a5");var t=n("7618"),r=n("f499"),o=n.n(r),i=n("0a0d"),c=n.n(i),a=(n("6b54"),n("a745")),s=n.n(a),u=function(){s.a||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var e={VERSION:"2.0.8",DEBUG:!1,log:{trace:function(){e.DEBUG&&console.log.apply(console,arguments)},info:function(){console.info.apply(console,arguments)},warn:function(){e.DEBUG&&console.warn.apply(console,arguments)},error:function(){console.error.apply(console,arguments)}},streams:{serial:"SERIAL",usb:"USB",hid:"HID"},websocket:{connection:null,connectConfig:{host:["localhost","localhost.qz.io"],hostIndex:0,usingSecure:!0,protocol:{secure:"wss://",insecure:"ws://"},port:{secure:[8181,8282,8383,8484],insecure:[8182,8283,8384,8485],portIndex:0},keepAlive:60,retries:0,delay:0},setup:{findConnection:function(t,n,r){if(t.port.secure.length)t.port.insecure.length||t.usingSecure||(e.log.trace("No insecure ports specified - forcing secure connection"),t.usingSecure=!0);else{if(!t.port.insecure.length)return void r(new Error("No ports have been specified to connect over"));t.usingSecure&&(e.log.error("No secure ports specified - forcing insecure connection"),t.usingSecure=!1)}var o,i=function(){if(t.port.portIndex++,t.usingSecure&&t.port.portIndex>=t.port.secure.length||!t.usingSecure&&t.port.portIndex>=t.port.insecure.length){if(t.hostIndex>=t.host.length-1)return void r(new Error("Unable to establish connection with QZ"));t.hostIndex++,t.port.portIndex=0}e.websocket.setup.findConnection(t,n,r)};o=t.usingSecure?t.protocol.secure+t.host[t.hostIndex]+":"+t.port.secure[t.port.portIndex]:t.protocol.insecure+t.host[t.hostIndex]+":"+t.port.insecure[t.port.portIndex];try{e.log.trace("Attempting connection",o),e.websocket.connection=new e.tools.ws(o)}catch(c){return e.log.error(c),void i()}null!=e.websocket.connection?(e.websocket.connection.established=!1,e.websocket.connection.onopen=function(i){if(!e.websocket.connection.established&&(e.log.trace(i),e.log.info("Established connection with QZ Tray on "+o),e.websocket.setup.openConnection({resolve:n,reject:r}),t.keepAlive>0))var c=setInterval(function(){u.websocket.isActive()?e.websocket.connection.send("ping"):clearInterval(c)},1e3*t.keepAlive)},e.websocket.connection.onclose=function(){e.websocket.connection&&"undefined"!==typeof navigator&&-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&e.websocket.connection.onerror()},e.websocket.connection.onerror=function(t){e.log.trace(t),e.websocket.connection=null,i()}):r(new Error("Unable to create a websocket connection"))},openConnection:function(t){function n(n){void 0===n&&(n=null),e.websocket.connection.sendData({certificate:n,promise:t})}e.websocket.connection.established=!0,e.websocket.connection.onclose=function(t){for(var n in e.log.trace(t),e.log.info("Closed connection with QZ Tray"),void 0!=e.websocket.connection.promise&&e.websocket.connection.promise.resolve(),e.websocket.callClose(t),e.websocket.connection=null,e.websocket.pendingCalls)e.websocket.pendingCalls.hasOwnProperty(n)&&e.websocket.pendingCalls[n].reject(new Error("Connection closed before response received"))},e.websocket.connection.onerror=function(t){e.websocket.callError(t)},e.websocket.connection.sendData=function(t){e.log.trace("Preparing object for websocket",t),void 0==t.timestamp&&(t.timestamp=c()(),"number"!==typeof t.timestamp&&(t.timestamp=(new Date).getTime())),void 0!=t.promise&&(t.uid=e.websocket.setup.newUID(),e.websocket.pendingCalls[t.uid]=t.promise),t.position={x:screen?(screen.availWidth||screen.width)/2+(screen.left||screen.availLeft):0,y:screen?(screen.availHeight||screen.height)/2+(screen.top||screen.availTop):0};try{if(void 0!=t.call&&void 0==t.signature){var n={call:t.call,params:t.params,timestamp:t.timestamp},r=e.tools.hash(e.tools.stringify(n));r.then||(r=e.tools.promise(function(e){e(r)})),r.then(function(t){return e.security.callSign(t)}).then(function(n){e.log.trace("Signature for call",n),t.signature=n,e.signContent=void 0,e.websocket.connection.send(e.tools.stringify(t))})}else e.log.trace("Signature for call",t.signature),e.websocket.connection.send(e.tools.stringify(t))}catch(o){e.log.error(o),void 0!=t.promise&&(t.promise.reject(o),delete e.websocket.pendingCalls[t.uid])}},e.websocket.connection.onmessage=function(t){var n=JSON.parse(t.data);if(null!=n.uid){e.log.trace("Received response from websocket",n);var r=e.websocket.pendingCalls[n.uid];void 0==r?e.log.warn("No promise found for returned response"):void 0!=n.error?r.reject(new Error(n.error)):r.resolve(n.result),delete e.websocket.pendingCalls[n.uid]}else if(null==n.type)e.websocket.connection.close(4003,"Connected to incompatible QZ Tray version");else switch(n.type){case e.streams.serial:n.event||(n.event=o()({portName:n.key,output:n.data})),e.serial.callSerial(JSON.parse(n.event));break;case e.streams.usb:n.event||(n.event=o()({vendorId:n.key[0],productId:n.key[1],output:n.data})),e.usb.callUsb(JSON.parse(n.event));break;case e.streams.hid:e.hid.callHid(JSON.parse(n.event));break;default:e.log.warn("Cannot determine stream type for callback",n);break}},e.security.callCert().then(n).catch(n)},newUID:function(){var e=6;return(new Array(e+1).join("0")+(Math.random()*Math.pow(36,e)<<0).toString(36)).slice(-e)}},dataPromise:function(t,n,r,o){return e.tools.promise(function(i,c){var a={call:t,promise:{resolve:i,reject:c},params:n,signature:r,timestamp:o};e.websocket.connection.sendData(a)})},pendingCalls:{},errorCallbacks:[],callError:function(t){if(s()(e.websocket.errorCallbacks))for(var n=0;n<e.websocket.errorCallbacks.length;n++)e.websocket.errorCallbacks[n](t);else e.websocket.errorCallbacks(t)},closedCallbacks:[],callClose:function(t){if(s()(e.websocket.closedCallbacks))for(var n=0;n<e.websocket.closedCallbacks.length;n++)e.websocket.closedCallbacks[n](t);else e.websocket.closedCallbacks(t)}},printing:{defaultConfig:{colorType:"color",copies:1,density:0,duplex:!1,fallbackDensity:null,interpolation:"bicubic",jobName:null,legacy:!1,margins:0,orientation:null,paperThickness:null,printerTray:null,rasterize:!0,rotation:0,scaleContent:!0,size:null,units:"in",altPrinting:!1,encoding:null,endOfDoc:null,perSpool:1}},serial:{serialCallbacks:[],callSerial:function(t){if(s()(e.serial.serialCallbacks))for(var n=0;n<e.serial.serialCallbacks.length;n++)e.serial.serialCallbacks[n](t);else e.serial.serialCallbacks(t)}},usb:{usbCallbacks:[],callUsb:function(t){if(s()(e.usb.usbCallbacks))for(var n=0;n<e.usb.usbCallbacks.length;n++)e.usb.usbCallbacks[n](t);else e.usb.usbCallbacks(t)}},hid:{hidCallbacks:[],callHid:function(t){if(s()(e.hid.hidCallbacks))for(var n=0;n<e.hid.hidCallbacks.length;n++)e.hid.hidCallbacks[n](t);else e.hid.hidCallbacks(t)}},security:{certPromise:function(e,t){t()},callCert:function(){return e.tools.promise(e.security.certPromise)},signaturePromise:function(){return function(e){e()}},callSign:function(t){return e.tools.promise(e.security.signaturePromise(t))}},tools:{promise:function(e){return new RSVP.Promise(e)},stringify:function(e){var t=Array.prototype.toJSON;delete Array.prototype.toJSON;var n=o()(e);return t&&(Array.prototype.toJSON=t),n},hash:function(e){return Sha256.hash(e)},ws:"undefined"!==typeof WebSocket?WebSocket:null,absolute:function(e){if("undefined"!==typeof window&&"function"===typeof document.createElement){var t=document.createElement("a");return t.href=e,t.href}return e},extend:function(n){"object"!==Object(t["a"])(n)&&(n={});for(var r=1;r<arguments.length;r++){var o=arguments[r];if(o)for(var i in o)if(o.hasOwnProperty(i)){if(n===o[i])continue;var c;if(o[i]&&o[i].constructor&&o[i].constructor===Object)c=s()(o[i])?n[i]||[]:n[i]||{},n[i]=e.tools.extend(c,o[i]);else void 0!==o[i]&&(n[i]=o[i])}}return n}}};function n(t,n){this.setPrinter=function(e){"string"===typeof e&&(e={name:e}),this.printer=e},this.getPrinter=function(){return this.printer},this.reconfigure=function(t){e.tools.extend(this.config,t)},this.getOptions=function(){return this.config},this.setPrinter(t),this.config=n}return n.prototype.print=function(e,t,n){u.print(this,e,t,n)},{websocket:{isActive:function(){return null!=e.websocket.connection&&e.websocket.connection.established},connect:function(t){return e.tools.promise(function(n,r){if(u.websocket.isActive())r(new Error("An open connection with QZ Tray already exists"));else if(null==e.websocket.connection)if(e.tools.ws)if(e.tools.ws.CLOSED&&2!=e.tools.ws.CLOSED){void 0==t&&(t={}),"undefined"!==typeof location&&"https:"===location.protocol||"undefined"===typeof t.usingSecure&&(e.log.trace("Disabling secure ports due to insecure page"),t.usingSecure=!1),"undefined"===typeof t.host||s()(t.host)||(t.host=[t.host]);var o=function o(i){var c=!1,a=function(){c||(c=!0,t&&i<t.retries?o(i+1):r.apply(null,arguments))},s=function(){var r=e.tools.extend({},e.websocket.connectConfig,t);e.websocket.setup.findConnection(r,n,a)};0==i?s():setTimeout(s,1e3*t.delay)};o(0)}else r(new Error("Unsupported WebSocket version detected: HyBi-00/Hixie-76"));else r(new Error("WebSocket not supported by this browser"));else r(new Error("The current connection attempt has not returned yet"))})},disconnect:function(){return e.tools.promise(function(t,n){u.websocket.isActive()?(e.websocket.connection.close(),e.websocket.connection.promise={resolve:t,reject:n}):n(new Error("No open connection with QZ Tray"))})},setErrorCallbacks:function(t){e.websocket.errorCallbacks=t},setClosedCallbacks:function(t){e.websocket.closedCallbacks=t},getNetworkInfo:function(t,n){return e.websocket.dataPromise("websocket.getNetworkInfo",{hostname:t,port:n})},getConnectionInfo:function(){if(e.websocket.connection){var t=e.websocket.connection.url.split(/[:\/]+/g);return{socket:t[0],host:t[1],port:+t[2]}}throw new Error("A connection to QZ has not been established yet")}},printers:{getDefault:function(){return e.websocket.dataPromise("printers.getDefault")},find:function(t){return e.websocket.dataPromise("printers.find",{query:t})}},configs:{setDefaults:function(t){e.tools.extend(e.printing.defaultConfig,t)},create:function(t,r){var o=e.tools.extend({},e.printing.defaultConfig,r);return new n(t,o)}},print:function(t,n,r,o){for(var i=0;i<n.length;i++)n[i].constructor===Object&&((!n[i].format&&n[i].type&&"RAW"!==n[i].type.toUpperCase()&&"DIRECT"!==n[i].type.toUpperCase()||n[i].format&&("FILE"===n[i].format.toUpperCase()||"IMAGE"===n[i].format.toUpperCase()&&(0!==n[i].data.indexOf("data:image/")||0===n[i].data.indexOf(";base64,"))||"XML"===n[i].format.toUpperCase()))&&(n[i].data=e.tools.absolute(n[i].data)),n[i].options&&"string"===typeof n[i].options.overlay&&(n[i].options.overlay=e.tools.absolute(n[i].options.overlay)));var c={printer:t.getPrinter(),options:t.getOptions(),data:n};return e.websocket.dataPromise("print",c,r,o)},serial:{findPorts:function(){return e.websocket.dataPromise("serial.findPorts")},setSerialCallbacks:function(t){e.serial.serialCallbacks=t},openPort:function(t,n){var r={port:t,options:n};return e.websocket.dataPromise("serial.openPort",r)},sendData:function(t,n,r){null!=r&&e.log.warn("Properties object is deprecated on sendData calls, use openPort instead.");var o={port:t,data:n,properties:r};return e.websocket.dataPromise("serial.sendData",o)},closePort:function(t){return e.websocket.dataPromise("serial.closePort",{port:t})}},usb:{listDevices:function(t){return e.websocket.dataPromise("usb.listDevices",{includeHubs:t})},listInterfaces:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1]}),e.websocket.dataPromise("usb.listInterfaces",n)},listEndpoints:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1],interface:arguments[2]}),e.websocket.dataPromise("usb.listEndpoints",n)},setUsbCallbacks:function(t){e.usb.usbCallbacks=t},claimDevice:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1],interface:arguments[2]}),e.websocket.dataPromise("usb.claimDevice",n)},isClaimed:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1]}),e.websocket.dataPromise("usb.isClaimed",n)},sendData:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1],endpoint:arguments[2],data:arguments[3]}),e.websocket.dataPromise("usb.sendData",n)},readData:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1],endpoint:arguments[2],responseSize:arguments[3]}),e.websocket.dataPromise("usb.readData",n)},openStream:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1],endpoint:arguments[2],responseSize:arguments[3],interval:arguments[4]}),e.websocket.dataPromise("usb.openStream",n)},closeStream:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1],endpoint:arguments[2]}),e.websocket.dataPromise("usb.closeStream",n)},releaseDevice:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1]}),e.websocket.dataPromise("usb.releaseDevice",n)}},hid:{listDevices:function(){return e.websocket.dataPromise("hid.listDevices")},startListening:function(){return e.websocket.dataPromise("hid.startListening")},stopListening:function(){return e.websocket.dataPromise("hid.stopListening")},setHidCallbacks:function(t){e.hid.hidCallbacks=t},claimDevice:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1]}),e.websocket.dataPromise("hid.claimDevice",n)},isClaimed:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1]}),e.websocket.dataPromise("hid.isClaimed",n)},sendData:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1],data:arguments[2],endpoint:arguments[3]}),e.websocket.dataPromise("hid.sendData",n)},readData:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1],responseSize:arguments[2]}),e.websocket.dataPromise("hid.readData",n)},openStream:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1],responseSize:arguments[2],interval:arguments[3]}),e.websocket.dataPromise("hid.openStream",n)},closeStream:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1]}),e.websocket.dataPromise("hid.closeStream",n)},releaseDevice:function(n){return"object"!==Object(t["a"])(n)&&(n={vendorId:arguments[0],productId:arguments[1]}),e.websocket.dataPromise("hid.releaseDevice",n)}},security:{setCertificatePromise:function(t){e.security.certPromise=t},setSignaturePromise:function(t){e.security.signaturePromise=t}},api:{showDebug:function(t){e.DEBUG=t},getVersion:function(){return e.websocket.dataPromise("getVersion")},setPromiseType:function(t){e.tools.promise=t},setSha256Type:function(t){e.tools.hash=t},setWebSocketType:function(t){e.tools.ws=t}},version:e.VERSION}}();(function(){if("function"===typeof define&&n("3c35"))define(u);else if("object"===("undefined"===typeof exports?"undefined":Object(t["a"])(exports))){e.exports=u;try{var r=n("1c46");u.api.setSha256Type(function(e){return r.createHash("sha256").update(e).digest("hex")})}catch(o){}}else window.qz=u})()}.call(this,n("dd40")(e))}});
//# sourceMappingURL=app.651f3734.js.map